<!DOCTYPE html>
<html>
<head>
<title>Plakattekontroller</title>
<script src="Tree.js" type="text/javascript"></script>
<script src="Auto.js" type="text/javascript"></script>
<script src="Score.js" type="text/javascript"></script>
<script src="myGameArea.js" type="text/javascript"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
canvas {
    border:1
    px solid #d3d3d3;
    background-image: url("img/grass.png");
}
</style>
</head>
<body >
  <!--<p id="mouseCoors">MouseCoors</p>
  <p id="cara">CaraX</p>
  <p id="carb">CarbX</p>
  <p id="carc">CarcX</p>
  <p id="card">CardX</p>
  <p id="acolor">Actualcolor</p>
  <p id="bcolor">Actualcolor</p>
  <p id="ccolor">Actualcolor</p>
  <p id="dcolor">Actualcolor</p> -->
<button onmousedown="startGame()" >start</button>
<script>
var mycara;
var mycarb;
var mycarc;
var mycard;
var mytree;
var maxg=0.001;
var ming=0.0005;
var maxY=600;
var minY=350;
var maxX=20;
var minX=800;
var trees = [];
var everyBottom= [];
var everybody= [];
var result= [];
var ntrees = 4;
var posY;
var posX;
var actualax;
var actualay;
var actualbx;
var actualby;
var actualcx;
var actualcy;
var actualdx;
var actualdy;
var oncea;
var onceb;
var oncec;
var onced;
var oncefinal=1;
var myScore = new Score("30px", "Consolas", "black", 280, 40, "text");
var myTotal = new Score("30px", "Consolas", "black", 480, 40, "text");
var myOver = new Score("100px", "Consolas", "black", 200, 300, "text");

function startGame() {
  oncea=1;
  onceb=1;
  oncec=1;
  onced=1;
  myTotal.score+= myScore.tempScore;
  myOver.score+= 0;
  myScore.tempScore=0;
  myTotal.text="Score: " + myTotal.score;
  myOver.text="GAME OVER";
  for (var i = 0; i < ntrees; i++) {
    posY= Math.random() * (maxY - minY) + minY;
    posX= Math.random() * (maxX - minX) + minX;
    trees.push(new Tree(100, 100, "img/busch.png", posX, posY));
  }
    mycara= new Auto(100, 100, "img/carwhite.png",-50,310,"img/plakette2.png","red","green","img/abgas3.png");
    mycarb= new Auto(100, 100, "img/carblue.png",-50,400,"img/plakette3.png","yellow","yellow","img/abgas30.png");
    mycarc= new Auto(100, 100, "img/carpink.png",-50,500,"img/plakette4.png","green","red","img/abgas31.png");
    mycard= new Auto(100, 100, "img/caryellow.png",-50,600,"img/plakette2.png","red","green","img/abgas3.png");
    mycara.gravity= Math.random() * (maxg - ming) + ming;
    mycarb.gravity= Math.random() * (maxg - ming) + ming;
    mycarc.gravity= Math.random() * (maxg - ming) + ming;
    mycard.gravity= Math.random() * (maxg - ming) + ming;
    myGameArea.start();
}

function updateGameArea() {
    myGameArea.clear();
    myGameArea.frameNo += 1;
    mycara.newPos();
    mycarb.newPos();
    mycarc.newPos();
    mycard.newPos();
    everybody = [mycara, mycarb, mycarc,mycard, trees[0], trees[1], trees[2], trees[3]];
    everyBottom = [mycara.getMyBottom(), mycarb.getMyBottom(), mycarc.getMyBottom(),mycard.getMyBottom(), trees[0].getMyBottom(), trees[1].getMyBottom(), trees[2].getMyBottom(), trees[3].getMyBottom()];
    bubbleSort(everyBottom);
    for (var j = 0; j < 8; j++){
      for (var k = 0; k < 8; k++){
        if (everyBottom[j] == everybody[k].getMyBottom()){
          result[j] = everybody[k];
        }
      }
    }
    for (var l=0; l<8; l++){
      result[l].update();
    }
    actualax = mycara.getPosX();
    actualay = mycara.getPosY();
    //document.getElementById('cara').innerHTML = 'Cara PosX : ' + actualax + ' PosY: ' + actualay;
    actualbx = mycarb.getPosX();
    actualby = mycarb.getPosY();
    //document.getElementById('carb').innerHTML = 'Carb PosX : ' + actualbx + ' PosY: ' + actualby;
    actualcx = mycarc.getPosX();
    actualcy = mycarc.getPosY();
    //document.getElementById('carc').innerHTML = 'Carc PosX : ' + actualcx + ' PosY: ' + actualcy;
    actualdx = mycard.getPosX();
    actualdy = mycard.getPosY();
    //document.getElementById('card').innerHTML = 'Card PosX : ' + actualdx + ' PosY: ' + actualdy;
    if(mycara.getPosX()<1000){
      myScore.text="Correct: " + myScore.score;
    } else if (mycara.correctColor()&& oncea){
      oncea=0;
      myScore.tempScore += 1;
      myScore.text="Correct: " + myScore.score;
    }
    if(mycarb.getPosX()<1000){
      myScore.text="Correct: " + myScore.score;
    } else if (mycarb.correctColor()&& onceb){
      onceb=0;
      myScore.tempScore += 1;
      myScore.text="Correct: " + myScore.score;
    }
    if(mycarc.getPosX()<1000){
      myScore.text="Correct: " + myScore.score;
    } else if (mycarc.correctColor()&& oncec){
      oncec=0;
      myScore.tempScore += 1;
      myScore.text="Correct: " + myScore.score;
    }
    if(mycard.getPosX()<1000){
      myScore.text="Correct: " + myScore.score;
    } else if (mycard.correctColor()&& onced){
      onced=0;
      myScore.tempScore += 1;
      myScore.text="Correct: " + myScore.score;
    }
    myScore.score= myScore.tempScore;
    myScore.update();
    myTotal.update();
    if (myScore.tempScore==4){
      startGame()
    } else if((actualax>1000) && (actualbx>1000) && (actualcx>1000) && (actualdx>1000) && (oncefinal==1)) {
      oncefinal=0;
      myScore.text="Correct: " + myScore.score;
      myScore.update();
      myTotal.score+= myScore.tempScore;
      myTotal.text="Score: " + myTotal.score;
      myTotal.update();
      alert("GAME OVER");
      document.location.reload();
      //myOver.text="GAME OVER";
      //myOver.update();
      //startGame()

    }

}

function everyinterval(n) {
    if ((myGameArea.frameNo / n) % 1 == 0) {return true;}
    return false;
}

function accelerate(n) {
    mycara.gravity=n;
    mycarb.gravity=n;
    mycarc.gravity=n;
    mycard.gravity=n;
}

function mouseMoved(e) {
    mouseX = e.offsetX;
    mouseY = e.offsetY;
   //document.getElementById('mouseCoors').innerHTML = 'X: ' + mouseX + ' Y: ' + mouseY;
}

function mouseClicked(e) {
  var x= e.offsetX;
  var y= e.offsetY;
    whichCar(x,y);
    //alert( "You clicked here: " + x + "," + y);
}

function whichCar(x,y) {

  var actualrigtha= actualax + mycara.getMyRight();
  var actuallefta= actualay + mycara.getMyLeft();
  if (x < actualrigtha && x > actualax && y > mycara.getMyTop() && y <mycara.getMyBottom()) {
      plakettewechseln(mycara);
  }
  var actualrigthb= actualbx + mycarb.getMyRight();
  var actualleftb= actualby + mycarb.getMyLeft();

  if (x < actualrigthb && x > actualbx && y > mycarb.getMyTop() && y <mycarb.getMyBottom()) {
      plakettewechseln(mycarb);
  }
  var actualrigthc= actualcx + mycarc.getMyRight();
  var actualleftc= actualcy + mycarc.getMyLeft();

  if (x < actualrigthc && x > actualcx && y > mycarc.getMyTop() && y <mycarc.getMyBottom()) {
      plakettewechseln(mycarc);
  }
  var actualrigthd= actualdx + mycard.getMyRight();
  var actualleftd= actualdy + mycard.getMyLeft();
  if (x < actualrigthd && x > actualdx && y > mycard.getMyTop() && y <mycard.getMyBottom()) {
      plakettewechseln(mycard);
  }
}

function plakettewechseln(thisCar) {
  if (thisCar.getColor()=="red"){
    thisCar.setImage(1);
    thisCar.setColor("green");
  } else if (thisCar.getColor()=="green"){
    thisCar.setImage(2);
    thisCar.setColor("yellow");
  } else if (thisCar.getColor()=="yellow") {
    thisCar.setImage(3);
    thisCar.setColor("red");
  }
  //document.getElementById('acolor').innerHTML = 'Color of my cara: ' + mycara.getColor();
  //document.getElementById('bcolor').innerHTML = 'Color of my carb: ' + mycarb.getColor();
  //document.getElementById('ccolor').innerHTML = 'Color of my carc: ' + mycarc.getColor();
  //document.getElementById('dcolor').innerHTML = 'Color of my card: ' + mycard.getColor();
}

function bubbleSort(a) {
    var swapped;
    do {
        swapped = false;
        for (var i=0; i < a.length-1; i++) {
            if (a[i] > a[i+1]) {
                var temp = a[i];
                a[i] = a[i+1];
                a[i+1] = temp;
                swapped = true;
            }
        }
    } while (swapped);
}
</script>
<br>
</body>
</html>
